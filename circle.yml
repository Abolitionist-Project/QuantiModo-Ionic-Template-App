# Customize the test machine
machine:
  node:
    version: 4.1.0
  ruby:
    version: 2.1.2
  php:
    version: 5.6.2

# Customize dependencies
dependencies:
  post:
    #- wget https://saucelabs.com/downloads/sc-latest-linux.tar.gz
    #- tar -xzf sc-latest-linux.tar.gz
  pre:
    - git fetch --all --unshallow
    - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
    - git push git@heroku.com:qm-ionic.git $CIRCLE_SHA1:refs/heads/master --force
#    - "curl -X POST --data-urlencode 'payload={\"channel\": \"#web\", \"username\": \"CircleCI\", \"text\": \"Branch $CIRCLE_BRANCH has just been deployed to Heroku and is being tested by GhostInspector. You'll have to go here (https://github.com/Abolitionist-Project/QM-Docker/commits/develop) to look up which branch this is using the version number above until someone figures out how to include $CIRCLE_BRANCH in this message in circle.yml.  \", \"icon_emoji\": \":ghost:\"}' https://hooks.slack.com/services/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"

  override:
    # docker run -v /home/ubuntu/QM-Docker:/data --name qm-data maxexcloo/data
    # docker run -d --name qm-web -p 443:443 -p 80:80 --link mysql:mysql --volumes-from qm-data --env-file .env -e "DH_SIZE=512" quantimodo/web:develop

  cache_directories:
#    - "vendor"   # Cache vendor for faster app install.

test:
  override:
    - echo "This line is to prevent automatic test detection."
    - curl "https://api.ghostinspector.com/v1/suites/56f16ea949faa251569e24da/execute/?apiKey=f5b531ccd55da08abf35fadabd7b7b04f3d64312&commit="$(git rev-parse HEAD) > ghostinspector.json
    - php ghostinspector_parser.php

general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore
      - /release\/.*/ # or ignore regexes
      - /feature\/.*/ # or ignore regexes
  artifacts:
    - "/home/ubuntu/QM-Docker/ghostinspector.json"